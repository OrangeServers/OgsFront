<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>文件传输</title>

    <link rel="icon" href="/image/bitbug_favicon.ico">
    <link rel="stylesheet" href="/layui/css/layui.css">
    <link rel="stylesheet" href="/css/orange.css">

    <style>
        /*#demo6 {*/
        /*    background-image: url('image/文件夹.png');*/
        /*    background-color: Transparent;*/
        /*    background-repeat: no-repeat;*/
        /*    background-size: 100px 100px;*/
        /*    width: 100px;*/
        /*    height: 100px;*/
        /*    border: none;*/
        /*    vertical-align: bottom;*/
        /*}*/
        .orange-dir {
            /*background-image: url('image/文件夹.png');*/
            /*background-color: Transparent;*/
            /*background-repeat: no-repeat;*/
            /*background-size: 100px 100px;*/
            width: 100px;
            height: 90px;
            border: none;
            vertical-align: bottom;
        }

        .orange-dir > img {
            width: 50px;
            height: 40px;
            margin-top: 10px;
        }

        .orange-dir > p {
            color: #23262E;
            word-wrap: break-word;
            word-break: break-all;
        }

        .orange-dir:hover {
            background-color: #bfbfbf;
        }
    </style>

</head>
<body>
<div class="layui-layout layui-layout-admin">


    <div class="layui-body">

        <div class="orange-body" style="padding: 15px;">
            <div class="layui-btn-container" style="height: 30px;background-color: #fff;padding: 10px">
                <button class="layui-btn layui-btn-sm orange-btn-root">根目录</button>
                <button class="layui-btn layui-btn-sm orange-btn-checkout">返回上级目录</button>
                <button class="layui-btn layui-btn-sm orange-btn-file">上传文件</button>
                <button class="layui-btn layui-btn-sm orange-btn-reload">刷新当前目录</button>
            </div>

            <div class="file-div">
                <button class="layui-btn layui-btn-primary orange-dir" id="demo6" value="home">
                    <img src="image/文件夹2.png">
                    <p>home</p>
                </button>

            </div>

        </div>
    </div>

    <div class="layui-footer">
        <!-- 底部固定区域 -->
        <p>Copyright @ 2021-04-09 by Xuzhiwei Version1.0</p>
    </div>
</div>


<script src="/layui/layui.js"></script>
<script src="/js/jquery-3.3.1.js"></script>
<script src="/js/jquery.cookie.min.js"></script>
<script src="/js/conf.js"></script>
<script src="/js/main.js"></script>
<!-- Chart code -->

<script>


    layui.use(['dropdown', 'util', 'layer', 'table', 'element'], function () {
        let element = layui.element,
            dropdown = layui.dropdown,
            util = layui.util,
            layer = layui.layer,
            table = layui.table,
            $ = layui.jquery;

        get_user_auth_list('filetransfer')

        // $("#demo6").dblclick(function (){
        //     layer.msg($(this).val())
        // })
        // $(".orange-btn-checkout").on('click', function () {
        //     file_render(window.file_ispath)
        // })
        $(".orange-btn-checkout").on('click', function () {
            if (window.file_ispath === '/'){
                file_render('/')
                layer.msg('已经到根目录了')
            } else {
                file_render(window.file_ispath, 'checkout')
            }
        })

        $(".orange-btn-root").on('click', function () {
            file_render('/')
        })

        $(".orange-btn-file").on('click', function () {
            layer.msg('file')
        })

        $(".orange-btn-reload").on('click', function () {
            file_render()
        })

        function file_render(file_path, get_type = 'get') {
            $(".file-div").html('')
            $.ajax({
                type: "POST",
                url: ogs_backend_url + "/local/file/def_get",
                dataType: "JSON",
                data: {'req_dir': file_path, 'get_file_type': get_type},
                success: function (res) {
                    console.log(res)
                    window.file_ispath = res['ispath']
                    // let html = ''
                    let res_dir = res['dir']
                    let res_file = res['file']
                    for (let i = 0; i < res_dir.length; i++) {
                        let html = '                <button class="layui-btn layui-btn-primary orange-dir" value="' + res_dir[i] + '" id="orange-dir-' + i + '">\n' +
                            '                    <img src="image/文件夹2.png">\n' +
                            '                    <p>' + res_dir[i] + '</p>\n' +
                            '                </button>'
                        $(".file-div").append(html)
                        dropdown.render({
                            elem: "#orange-dir-" + i //也可绑定到 document，从而重置整个右键
                            , trigger: 'contextmenu' //contextmenu
                            , isAllowSpread: false //禁止菜单组展开收缩
                            , style: 'width: 200px' //定义宽度，默认自适应
                            , id: 'test788' //定义唯一索引
                            , data: [{
                                title: '进入'
                                , id: 'load'
                            }, {
                                title: '重命名'
                                , id: 'rename'
                            }, {
                                title: '删除'
                                , id: 'del'
                            }]
                            , click: function (obj, othis) {
                                if (obj.id === 'load') {
                                    file_render(res['ispath'] + res_dir[i])
                                } else if (obj.id === 'print') {
                                    window.print();
                                } else if (obj.id === 'reload') {
                                    location.reload();
                                }
                            }
                        });
                        $("#" + "orange-dir-" + i).dblclick(function () {
                            console.log($(this).val())
                            file_render(res['ispath'] + res_dir[i])
                        })
                    }

                    for (let y = 0; y < res_file.length; y++) {
                        let html = '                <button class="layui-btn layui-btn-primary orange-dir" id="orange-file-' + y + '">\n' +
                            '                    <img src="image/文件2.png">\n' +
                            '                    <p>' + res_file[y] + '</p>\n' +
                            '                </button>'
                        $(".file-div").append(html)
                        dropdown.render({
                            elem: "#orange-file-" + y //也可绑定到 document，从而重置整个右键
                            , trigger: 'contextmenu' //contextmenu
                            , isAllowSpread: false //禁止菜单组展开收缩
                            , style: 'width: 200px' //定义宽度，默认自适应
                            , id: 'test799' //定义唯一索引
                            , data: [{
                                title: '下载'
                                , id: 'dow'
                            }, {
                                title: '重命名'
                                , id: 'rename'
                            }, {
                                title: '删除'
                                , id: 'del'
                            }]
                            , click: function (obj, othis) {
                                if (obj.id === 'dow') {
                                    layer.msg('click');
                                    window.open('http://10.0.1.198:18000/local/download?filename=' + res_file[y])
                                } else if (obj.id === 'rename') {
                                    window.print();
                                } else if (obj.id === 'del') {
                                    $.ajax({
                                        type: "POST",
                                        url: ogs_backend_url + "/local/file/del",
                                        dataType: "JSON",
                                        data: {'req_dir': res_file[y]},
                                        success: function (res) {
                                            if (res['status'] === 'true') {
                                                file_render('')
                                            }
                                        }
                                    })
                                }
                            }
                        });
                    }
                }
            })
        }

        file_render('/')


    })
</script>
</body>
</html>
